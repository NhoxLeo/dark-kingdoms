<style>
.side-text {
	    margin-left: 20px;
	}
	
    .small-image {
	    width: 200px;
	}
	
	.med-image {
	    width: 500px;
	}
	
	.center {
	    text-align: center;
	}
	
	.white-text {
		color: white;
	}
</style>
		
<body background="stone wall.jpg">

<div style="display:inline-block;vertical-align:top;">
    <video id="stevequiz" controls preload >
        <source src="dark_kingdoms_1-00.mp4">
</video>
</div>

<div class="white-text" style="display:inline-block;">
	<p class="side-text">A small project in which I am attempting to design large-scale, autonomous battles.  The units include code for movement, targeting and attacks.<br/></p>
	<ul>
		<li>the prototype can handle 200 v 200 battles before starting to lag</li>
		<li> sliders for choosing army mix automatically adjust to allow a maximum of 200 units per army</li>
		<li>I use Physics2D.OverlapCircleAll() to get enemies within visibility range and then choose the closet one using Vector3.Distance()</li>
		<li>a number of movement strategies are implemented, including random, march and moveWithinDistanceOfTarget</li>
		<li>random movement is not completely random, it includes a stride attribute which tends to keep units going in the same direction,<br/>
		    occasionally changing direction, for more natural looking wandering</li>
		<li>armies are setup at the beginning in rows of 100 units, melee in front, archers in back.....or will be once I get the kinks out</li>
		
	</ul>
	
	<div class="center">
		<img class="med-image" src="orcs-march.gif">
	</div>
	
</div>

<div>
<p>
<br/><br/><br/>
</p>
</div>


<div style="display:inline-block;vertical-align:top;">
    <video id="stevequiz" controls preload >
        <source src="dark_kingdoms_1-01.mp4">
</video>
</div>

<div class="white-text" style="display:inline-block;">
	<p class="side-text">It's been a few releases of Unity since I first implemented this.  Added some major performance improvements and some movement tweaks</p>
	<ul>
		<li>simply turning off all Physics2D collisions for the layers of both armies allowed me to scale up to 800 v 800 with no lag, 1200 v 1200<br/>
		    with a little lag</li>
		<li>I tried replacing Physics2D.OverlapCircleAll() with Physics2D.OverlapCircleNonAlloc() but I didn't really see any reduction in lag</li>
		<li>updated "move to target" algorithm to something that moves directly towards the enemy unit rather going on a diagonal and then straight<br/>
		    See my code gist for details.......<a class="white-text" href="https://gist.github.com/sdocy/c1af05209212e6bdbd3cc3844f48092b"> mvt_stayWithin()</a></li>
		<li>added small per-unit variance in movement speed, now the armies look much more natural as they charge at each other.  I love when a simple<br/>
		    idea adds a lot of depth to what you are working on</li>
		<li>I need to update the sliders to handle the larger army sizes (I currently just hacked my army spawner to get bigger armies) and that will fix<br/>
		    the troop counters on the battle page</li>
	</ul>
	
	<div class="center">
		<a href="#"><img class="med-image" src="https://sdocy.github.io/dark-kingdoms/layers.png"></a>
	</div>
</div>

<div class="white-text">
	<p><br/>TODO:<br/></p>
	<ul>
		<li>Play with something I am calling "dynamic visibility".  Currently, visibility (the radius used for OverLapCircleAll()) is set to 2.0f for all units.<br/>
		    I am thinking that I could reduce this range when there are lots of units on the board (perhaps 1000+) and increase it as units get killed off.<br/>
			My assumption is that this could significantly improve performance by reducing the work overLapCircleAll() must do and also reduce the number of<br/>
			objects my code must examine with Vector3.Distance() to find the closest.  This should be especially useful for melee units who get in close to<br/>
			to each other.  It will likely have the undesirable effect of causing archers to move closer than I want to their targets, so I will likely<br/>
			only implement it for melee.</li>
			<li>play with Vector2.Distance() instead of Vector3.Distance()</li>
			<li>play with turning off remaining Physics.2D layers for brown and red team, see if it helps performance any more even though there are no<br/>
			    other objects for them to collide with</li>
			<li> replace army size hack with actual support for larger army sizes, requires updates to sliders and correctly breaking the armies into rows</li>
	</ul>
</div>	
